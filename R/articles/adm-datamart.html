<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>adm-datamart • pdstools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="adm-datamart">
<meta property="og:description" content="pdstools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pdstools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/adhoc-datasetanalysis.html">adhoc-datasetanalysis</a>
    </li>
    <li>
      <a href="../articles/adm-datamart.html">adm-datamart</a>
    </li>
    <li>
      <a href="../articles/adm-explained.html">adm-explained</a>
    </li>
    <li>
      <a href="../articles/historical-dataset.html">historical-dataset</a>
    </li>
    <li>
      <a href="../articles/ih-reporting.html">ih-reporting</a>
    </li>
    <li>
      <a href="../articles/snapshots-to-scorecards.html">snapshots-to-scorecards</a>
    </li>
    <li>
      <a href="../articles/thompson-sampling-explained.html">thompson-sampling-explained</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>adm-datamart</h1>
                        <h4 data-toc-skip class="author">Pega</h4>
            
            <h4 data-toc-skip class="date">2023-07-06</h4>
      
      
      <div class="hidden name"><code>adm-datamart.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="adm-datamart">ADM Datamart<a class="anchor" aria-label="anchor" href="#adm-datamart"></a>
</h2>
<p>The ADM Datamart is an open database schema where the ADM models and
all predictors are copied into. The standard ADM reports both in
Analytics Center as well as in the Report Browser (Adaptive category)
work off this schema.</p>
<p>Since the schema is open we can easily use it to create our own
reports and support measurements and plots not available in the OOTB
reporting in Pega.</p>
</div>
<div class="section level2">
<h2 id="data-loading">Data Loading<a class="anchor" aria-label="anchor" href="#data-loading"></a>
</h2>
<p>Let’s first load the data. An example export is provided with the
package. Ways to load your own data from the database or from a dataset
export will be described later.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">pdstools</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># include below when developing the library</span></span>
<span><span class="co"># invisible(sapply(list.files("~/Documents/pega/cdh-datascientist-tools/r/R", "*.R", full.names = T), source))</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">adm_datamart</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="data-loading-using-datasets">Data Loading using Datasets<a class="anchor" aria-label="anchor" href="#data-loading-using-datasets"></a>
</h3>
<p>To load your own data, export the datasets from Pega, download them
to your filesystem and let the <code>pdstools</code> library import
it.</p>
<p>The <code>ADMDatamart</code> function is a very generic function to
read the model and optionally predictor data into a simple list
structure that is universally used by the <code>pdstools</code>
functions. The most basic usage is to only give it a folder location
where you downloaded the dataset exports, but it supports different file
types and allows for filtering etc.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adm_datamart</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ADMDatamart.html">ADMDatamart</a></span><span class="op">(</span><span class="st">"~/Downloads"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-loading-directly-from-the-database">Data Loading directly from the database<a class="anchor" aria-label="anchor" href="#data-loading-directly-from-the-database"></a>
</h3>
<p>If you have database access you can also load the data directly from
the DB. All you need is a JDBC driver and the proper credentials.</p>
</div>
</div>
<div class="section level2">
<h2 id="model-reports">Model Reports<a class="anchor" aria-label="anchor" href="#model-reports"></a>
</h2>
<p>With the data loaded, we can start with a plot similar to what the
Analytics Center provides OOTB, however here we have more flexibility to
slice &amp; dice.</p>
<div class="section level3">
<h3 id="bubble-chart-by-issue-and-channel">Bubble chart by Issue and Channel<a class="anchor" aria-label="anchor" href="#bubble-chart-by-issue-and-channel"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotPerformanceSuccessRateBubbleChart.html">plotPerformanceSuccessRateBubbleChart</a></span><span class="op">(</span><span class="va">adm_datamart</span>, facets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Issue"</span>, <span class="st">"Channel"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">70</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Performance"</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">52</span>,<span class="fl">90</span><span class="op">)</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span></span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-3-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="aggregated-to-channels">Aggregated to Channels<a class="anchor" aria-label="anchor" href="#aggregated-to-channels"></a>
</h3>
<p>We can zoom in into the performance and success rates of the various
channels. Here you see that success rates for e-mail are low, as is the
average model performance.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotPerformanceSuccessRateBoxPlot.html">plotPerformanceSuccessRateBoxPlot</a></span><span class="op">(</span><span class="va">adm_datamart</span>, <span class="st">"Channel"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">70</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Performance"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_discrete_qualitative</span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Harmonic"</span><span class="op">)</span></span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;">
# Predictors</p>
</div>
<div class="section level3">
<h3 id="sensitity-analysis">Sensitity Analysis<a class="anchor" aria-label="anchor" href="#sensitity-analysis"></a>
</h3>
<p>Showing the overall predictor contributions to the models.</p>
<p>Here we “facet” by model rule (ConfigurationName) but you can also
leave this out or facet by e.g. Channel or Issue.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotPredictorImportance.html">plotPredictorImportance</a></span><span class="op">(</span><span class="va">adm_datamart</span>, limit <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-5-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="predictor-vs-action-heatmap">Predictor vs Action heatmap<a class="anchor" aria-label="anchor" href="#predictor-vs-action-heatmap"></a>
</h3>
<p>You can also show the predictor performance in one plot across all
predictors for all the selected models. Also arranging by performance in
both dimensions gives a quick visual clue of which predictors and which
models need attention.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotPredictorImportanceHeatmap.html">plotPredictorImportanceHeatmap</a></span><span class="op">(</span><span class="va">adm_datamart</span>, </span>
<span>                                  aggregation<span class="op">=</span><span class="st">"Name"</span>, limit <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span>, angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-6-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="alternative-performance-metrics">Alternative Performance Metrics<a class="anchor" aria-label="anchor" href="#alternative-performance-metrics"></a>
</h3>
<p>With all the data available in the datamart, you are not restricted
to just reporting. Using the binning information for all of the
predictors, you could, for example, calculate the KS score of the
models. The KS (Kolmogorov–Smirnov) score is related to the AUC that we
use by default, but instead of the areas under the ROC curve, it gives
the maximum separation between the true positive and false positive
rate.</p>
<p>The below snippet calculates the KS score for all predictors of all
propositions and shows them next to AUC reported by ADM.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adm_datamart_binning_latest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filterLatestSnapshotOnly.html">filterLatestSnapshotOnly</a></span><span class="op">(</span><span class="va">adm_datamart</span><span class="op">$</span><span class="va">predictordata</span><span class="op">)</span></span>
<span><span class="fu">setorder</span><span class="op">(</span><span class="va">adm_datamart_binning_latest</span>, <span class="va">Propensity</span><span class="op">)</span></span>
<span><span class="va">myKS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">binning</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">Goods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">binning</span><span class="op">$</span><span class="va">BinNegatives</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">binning</span><span class="op">$</span><span class="va">BinNegatives</span><span class="op">)</span></span>
<span>  <span class="va">Bads</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">binning</span><span class="op">$</span><span class="va">BinPositives</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">binning</span><span class="op">$</span><span class="va">BinPositives</span><span class="op">)</span></span>
<span>  <span class="va">KS</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">Goods</span> <span class="op">-</span> <span class="va">Bads</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">KS</span><span class="op">)</span>,<span class="fl">0</span>,<span class="va">KS</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">performanceSummary</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">adm_datamart_binning_latest</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>KS <span class="op">=</span> <span class="fu">myKS</span><span class="op">(</span><span class="va">.SD</span><span class="op">)</span>,</span>
<span>                                           auc <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">Performance</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                                       by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ModelID"</span>, <span class="st">"PredictorName"</span>,<span class="st">"EntryType"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>            <span class="fu"><a href="../reference/filterLatestSnapshotOnly.html">filterLatestSnapshotOnly</a></span><span class="op">(</span><span class="va">adm_datamart</span><span class="op">$</span><span class="va">modeldata</span><span class="op">)</span>,</span>
<span>            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ModelID"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Show KS numbers</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">performanceSummary</span><span class="op">[</span><span class="va">KS</span> <span class="op">&gt;</span> <span class="fl">0.01</span><span class="op">]</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">Channel</span>,<span class="va">Name</span>,sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">PredictorName</span>,</span>
<span>                        levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">performanceSummary</span><span class="op">$</span><span class="va">PredictorName</span>,decreasing <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, <span class="st">"Classifier"</span><span class="op">)</span>,<span class="st">"Classifier"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="op">(</span><span class="va">EntryType</span><span class="op">==</span><span class="st">"Classifier"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">""</span>,y<span class="op">=</span><span class="st">""</span>,title<span class="op">=</span><span class="st">"Kolmogorov–Smirnov scores"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2f%%"</span>,<span class="fl">100</span><span class="op">*</span><span class="va">KS</span><span class="op">)</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Spectral"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"none"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span>, angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-7-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="model-performance">Model Performance<a class="anchor" aria-label="anchor" href="#model-performance"></a>
</h2>
<div class="section level3">
<h3 id="standard-model-classifier-plot">Standard Model Classifier plot<a class="anchor" aria-label="anchor" href="#standard-model-classifier-plot"></a>
</h3>
<p>In the product models are represented by a score distribution plot
like below</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">adm_datamart_binning_latest</span><span class="op">[</span><span class="va">ModelID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="../reference/filterLatestSnapshotOnly.html">filterLatestSnapshotOnly</a></span><span class="op">(</span><span class="va">adm_datamart</span><span class="op">$</span><span class="va">modeldata</span><span class="op">)</span><span class="op">[</span><span class="va">Name</span><span class="op">==</span><span class="st">"FirstMortgage"</span><span class="op">]</span><span class="op">$</span><span class="va">ModelID</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotBinning.html">plotBinning</a></span><span class="op">(</span><span class="fu"><a href="../reference/filterClassifierOnly.html">filterClassifierOnly</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">Name</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span>, subtitle <span class="op">=</span> <span class="st">"Classifier"</span><span class="op">)</span></span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-8-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="gains-and-lift-charts">Gains and Lift Charts<a class="anchor" aria-label="anchor" href="#gains-and-lift-charts"></a>
</h3>
<p>The same data can be represented as a cumulative gains chart, which
indicates the percentage of positive responses as a function of the size
of the population targeted.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotCumulativeGains.html">plotCumulativeGains</a></span> <span class="op">(</span><span class="fu"><a href="../reference/filterClassifierOnly.html">filterClassifierOnly</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">Name</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span>, subtitle <span class="op">=</span> <span class="st">"Cumulative Gains"</span><span class="op">)</span></span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-9-1.png" width="480" style="display: block; margin: auto;"></p>
<p>A similar view is given by the cumulative lift graphs. This gives
insight into what percentage of the customers should be targeted by the
models to achieve a certain lift in response rates. Both plots are
included in the off-line model reports.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotCumulativeLift.html">plotCumulativeLift</a></span> <span class="op">(</span><span class="fu"><a href="../reference/filterClassifierOnly.html">filterClassifierOnly</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">Name</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span>, subtitle <span class="op">=</span> <span class="st">"Lift"</span><span class="op">)</span></span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-10-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="trend-charts">Trend charts<a class="anchor" aria-label="anchor" href="#trend-charts"></a>
</h2>
<p>Out of the box, model data is stored over time. This allows trend
charts to be created for the performance of models.</p>
<p>The below plots nicely show how the models ramp up over the course of
a few hours. We aggregate up to Group level to avoid having too many
lines in the plot.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotPerformanceOverTime.html">plotPerformanceOverTime</a></span><span class="op">(</span><span class="va">adm_datamart</span>, aggregation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Issue"</span>, <span class="st">"Group"</span><span class="op">)</span>, facets <span class="op">=</span> <span class="st">"Channel"</span><span class="op">)</span></span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;"></p>
<p>All the plotting functions are fairly straightforward and built on
<em>ggplot</em> and <em>data.table</em>. When there is no standard
supporting plot function, it is easy enough to write your own. For
example, to show the performance of the Age predictor over time and
across all models.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predictorPerformanceTrend</span> <span class="op">&lt;-</span> <span class="va">adm_datamart</span><span class="op">$</span><span class="va">predictordata</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/startsWith.html" class="external-link">startsWith</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">PredictorName</span><span class="op">)</span>, <span class="st">"Customer.A"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">BinIndex</span> <span class="op">==</span> <span class="fl">1</span>, </span>
<span>                                                    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>AUC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">AUC</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                                                    by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SnapshotTime"</span>,<span class="st">"PredictorName"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">predictorPerformanceTrend</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">SnapshotTime</span>, <span class="va">AUC</span>, color<span class="op">=</span><span class="va">PredictorName</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Performance over Time"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-12-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="predictor-binning-evolution">Predictor Binning Evolution<a class="anchor" aria-label="anchor" href="#predictor-binning-evolution"></a>
</h2>
<p>With the detailed binning information available over time, we can
show how the binning of a predictor evolves. You see that the number of
bins grows as more data becomes available. You also see that this
predictor isn’t always active (grey instead of blue).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binningOverTime</span> <span class="op">&lt;-</span> <span class="va">adm_datamart</span><span class="op">$</span><span class="va">predictordata</span><span class="op">[</span><span class="va">PredictorName</span><span class="op">==</span><span class="st">"Customer.Age"</span> <span class="op">&amp;</span> <span class="va">ModelID</span> <span class="op">==</span> <span class="va">model</span><span class="op">$</span><span class="va">ModelID</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">grid.arrange</span><span class="op">(</span>grobs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">binningOverTime</span><span class="op">$</span><span class="va">SnapshotTime</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span> </span>
<span>  <span class="fu"><a href="../reference/plotBinning.html">plotBinning</a></span><span class="op">(</span><span class="va">binningOverTime</span><span class="op">[</span><span class="va">SnapshotTime</span><span class="op">==</span><span class="va">t</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-13-1.png" width="960" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Otto Perdeck.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
