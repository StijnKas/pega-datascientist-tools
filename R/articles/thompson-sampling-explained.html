<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>thompson-sampling-explained • pdstools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="thompson-sampling-explained">
<meta property="og:description" content="pdstools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pdstools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/adhoc-datasetanalysis.html">adhoc-datasetanalysis</a>
    </li>
    <li>
      <a href="../articles/adm-datamart.html">adm-datamart</a>
    </li>
    <li>
      <a href="../articles/adm-explained.html">adm-explained</a>
    </li>
    <li>
      <a href="../articles/historical-dataset.html">historical-dataset</a>
    </li>
    <li>
      <a href="../articles/ih-reporting.html">ih-reporting</a>
    </li>
    <li>
      <a href="../articles/snapshots-to-scorecards.html">snapshots-to-scorecards</a>
    </li>
    <li>
      <a href="../articles/thompson-sampling-explained.html">thompson-sampling-explained</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>thompson-sampling-explained</h1>
                        <h4 data-toc-skip class="author">Pega</h4>
            
            <h4 data-toc-skip class="date">2023-07-06</h4>
      
      
      <div class="hidden name"><code>thompson-sampling-explained.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="thompson-sampling">Thompson Sampling<a class="anchor" aria-label="anchor" href="#thompson-sampling"></a>
</h2>
<p>Pega Customer Decision Hub uses a mechanism called Thompson Sampling,
which is a method to sample the propensities from a distribution that
centers around the model propensity. The width of the distribution
depends on the evidence the model has seen. For new actions the
propensities are random between 0 and 1. When the model gathers more
evidence, the sampled propensities get closer to the model
propensities.</p>
<p>This mechanism helps in a few different ways. For outbound channels,
when multiple new actions are launched, they will all have the same 0.5
propensity (that is where a new model starts). Thompson Sampling
effectively adds a bit of noise so it is not always the same new action
that gets selected. For both inbound and outbound channels, Thompson
Sampling helps to add some extra “exploration” to the models in the
early phases.</p>
<p>See also:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Thompson_sampling" class="external-link uri">https://en.wikipedia.org/wiki/Thompson_sampling</a></li>
<li>
<a href="https://docs.pega.com/pega-customer-decision-hub-user-guide/87/model-learning-new-actions" class="external-link uri">https://docs.pega.com/pega-customer-decision-hub-user-guide/87/model-learning-new-actions</a>.</li>
</ul>
<div class="section level3">
<h3 id="spread-of-the-thompson-sampled-propensities">Spread of the Thompson Sampled propensities<a class="anchor" aria-label="anchor" href="#spread-of-the-thompson-sampled-propensities"></a>
</h3>
<p>The following plot shows how the spread of sampled propensities
narrows with more responses received by the models. We show simulated
results for a few different model propensities.</p>
<p><img src="thompson-sampling-explained_files/figure-html/unnamed-chunk-2-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="convergence-of-the-thompson-sampled-propensities">Convergence of the Thompson Sampled propensities<a class="anchor" aria-label="anchor" href="#convergence-of-the-thompson-sampled-propensities"></a>
</h3>
<p>To illustrate the fact that the Thompson Sampled propensities quickly
converge to the model propensities, below plot shows the percentage of
sampled propensities that are within 10% of the original model
propensity.</p>
<p>For new models (no responses) that is around 50% but at about 200
positive responses, around 90% of the sampled propensities are within
10% of the original model propensities. After 500 positive responses
almost all of the sampled propensities are within that range.</p>
<p>The colors indicate the same base propensities as before, but as can
be seen, the convergence rate is independent of the base
propensities.</p>
<p><img src="thompson-sampling-explained_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="beta-distribution">Beta distribution<a class="anchor" aria-label="anchor" href="#beta-distribution"></a>
</h3>
<p>In principle, Thompson Sampling is based on the <span class="math inline">\(\beta\)</span>-distribution (<a href="https://en.wikipedia.org/wiki/Beta_distribution" class="external-link uri">https://en.wikipedia.org/wiki/Beta_distribution</a>) with
“positive” and “negative” responses as the shape parameters.</p>
<p>But for practical reasons, instead of using <span class="math inline">\(\beta(positives, negatives)\)</span>, we
approximate this with <span class="math inline">\(\beta(p*evidence,
(1-p)*evidence)\)</span>.</p>
<div class="section level4">
<h4 id="using-positives-directly">Using Positives directly<a class="anchor" aria-label="anchor" href="#using-positives-directly"></a>
</h4>
<p>With <a href="https://agilestudio.pega.com/prweb/AgileStudio/app/agilestudio/bugs/BUG-803575" class="external-link uri">https://agilestudio.pega.com/prweb/AgileStudio/app/agilestudio/bugs/BUG-803575</a>
we will change the implementation in NBAD to use the positives directly
so it will become <span class="math inline">\(p + \beta(positives,
negatives) - \frac{positives}{evidence}\)</span> with <span class="math inline">\(evidence = positives + negatives\)</span>.</p>
</div>
<div class="section level4">
<h4 id="visualization-of-thompson-sampling">Visualization of Thompson Sampling<a class="anchor" aria-label="anchor" href="#visualization-of-thompson-sampling"></a>
</h4>
<p>Here we show the distribution for a few combinations of model
propensity and evidence. Note that the distributions do not have their
top at exactly the model propensity. This is because the beta
distribution gives values in the range 0..1 so for the (typical) small
propensity values, the distribution is somewhat right-tailed.</p>
<p><img src="thompson-sampling-explained_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="outbound-model-maturity">Outbound Model Maturity<a class="anchor" aria-label="anchor" href="#outbound-model-maturity"></a>
</h2>
<p>Thompson Sampling is related to the concept of Outbound Model
Maturity. In outbound channels, we limit the reach of new actions to
avoid sending too many actions “blindly” to customers. As more feedback
is accumulated, the percentage of the customers that can receive the new
actions is increased.</p>
<p>We start with 2% of the population for new actions and scale that
linearly to 100% until we reach a threshold of 200 positive responses.
This is illustrated by the following plot:</p>
<pre><code><span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre>
<p><img src="thompson-sampling-explained_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="effect-when-introducing-new-actions">Effect when introducing new actions<a class="anchor" aria-label="anchor" href="#effect-when-introducing-new-actions"></a>
</h3>
<p>Suppose we start with 5 actions and introduce a new action every
week. We receive feedback after a week, so the reach of the new actions
ramps up after each week until it reaches the 200 positives and is then
mixed with the other actions.</p>
<p>The plot below illustrates how many customers (out of a hypothetical
base of 100000) get the different actions.</p>
<p>Of course, in an actual implementation, there usually are more
factors that are considered whether or not to give an action. This
includes volume constraints, propensity thresholding and other
factors.</p>
<p><img src="thompson-sampling-explained_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="effect-on-all-new-actions">Effect on all new actions<a class="anchor" aria-label="anchor" href="#effect-on-all-new-actions"></a>
</h3>
<p>If at day zero all actions are new, it depends on the amount of
available actions.</p>
<p>If there are sufficient actions, then all customers may receive one,
but the targeting will not be very personalized. The distribution will
still look even.</p>
<p>If there are few actions, then the model maturity capping may have
the effect that initially not everyone will get an action. As the models
mature and become more targeted, this will change.</p>
<p><img src="thompson-sampling-explained_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Otto Perdeck.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
